<script type="text/javascript" src="/js/category-manager.js?<%=Time.now.to_i%>"></script>

<form action="/update-categories" method="post">
    <div id="categorylist-outercontainer">
        <button type="submit"><strong>Save Changes</strong></button>
        <button type="button" onclick="createCategory(null)">new category</button>
        <button type="button" class="set-parent-button" onclick="setParent(null)" style="display: none;">[none]</button>
        <div id="categorylist-innercontainer"></div>
        <button type="submit"><strong>Save Changes</strong></button>
    <div>
</form>

<script type="text/javascript">
    const append_list = [];
</script>
<%@categories.each do | category |%>
    <script type="text/javascript">
        var new_item = instantiateCategory("<%=category['category_name']%>", <%=category['category_id']%>, <%=category['background_color']%>, <%=category['text_color']%>);
        var nesting_level = <%=get_nesting_level(category['parent_id'])%>;
        if (nesting_level) {
            append_list.push({element: new_item, parent_id:"subcategories-<%=category['parent_id']%>"});
        }
        else {
            append_list.push({element: new_item, parent_id:"categorylist-innercontainer"});
        }
    </script>
<%end%>
<script type="text/javascript">
    append_list.forEach(element => {
        document.getElementById(element.parent_id).appendChild(element.element);
    });
</script>